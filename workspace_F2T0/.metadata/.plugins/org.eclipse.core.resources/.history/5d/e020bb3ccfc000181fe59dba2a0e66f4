package display;

import java.awt.Color;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.Image;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.awt.geom.AffineTransform;

import javax.swing.JPanel;

import main.Main;
import main.Target;


public class SourcePanel extends JPanel implements MouseListener{

	private static final long serialVersionUID = 1L;
	
	protected Main main;
	
	public SourcePanel(Main m){
		main=m;
		addMouseListener(this);
	}

	
	public void paintComponent(Graphics g){

		/// draw image camera
		if (Main.CAMERA_CONNECTED){
			Graphics2D g2d = (Graphics2D) g.create();
			AffineTransform at = new AffineTransform();
	        at.setToRotation(Math.PI, main.webcam.width()/2, main.webcam.height()/2);
	        at.setToScale(0.5, 0.5);
	        g2d.setTransform(at);
	        Image image = Main.Mat2bufferedImage(main.webcam);
	        g2d.drawImage(image, 500, 500, this);
		}
		
		// draw joystick position
		g.setColor(Color.gray);
 		g.drawOval(325+(int)(main.x_prev*0.5+35), 245-(int)(main.y_prev*0.5-35), 50, 50);
 		g.setColor(Color.white);
 		g.drawOval(325+(int)(main.x*0.5+35), 245-(int)(main.y*0.5-35), 50, 50);
 		g.drawLine(350+(int)(main.x*0.5+35), 270-(int)(main.y*0.5-35), 350+(int)(main.x*0.5+35)+(int)main.dx*5, 270-(int)(main.y*0.5-35)-(int)main.dy*5);
 		g.setColor(Color.red);
 		g.drawOval(325+(int)(main.x_next*0.5+35), 245-(int)(main.y_next*0.5-35), 50, 50);
	}

	public void mouseClicked(MouseEvent arg0) {}
	public void mouseEntered(MouseEvent arg0) {}
	public void mouseExited(MouseEvent arg0) {}
	
	public void mousePressed(MouseEvent e) {
		main.target.add(new Target(-350+(int)e.getX(), 270-(int)e.getY(),main.target_speed, main.target_type));
	}

	public void mouseReleased(MouseEvent arg0) {}
}